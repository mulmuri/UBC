<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UBC - Modernization of zbekistan Building Code System</title>
    <link rel="shortcut icon" type="image/x-icon" href="img/favicon.ico"/>

    <link rel="stylesheet" type="text/css" href="bootstrap.css">
    <link rel="stylesheet" type="text/css" href="all.css">
    <link rel="stylesheet" type="text/css" href="course.css">
    <script type="text/javascript" src="bootstrap/dist/js/bootstrap.bundle.js"></script>

    <link href="https://fonts.googleapis.com/css?family=Montserrat:100,200,300,400,500,600,700,800,900" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.1/font/bootstrap-icons.css">

</head>
<body>
    <div id="main-header">
        <div class="title-first">
            <span class="main-title title-1">Modernization of </span>
        </div>
        <div class="title-second">
            <span class="main-title title-2">Uzbekistan Building Code(UBC) </span> <span class="main-title title-3">System</span>
        </div>
    </div>

    <div id="main-body">
        <div class="course-box container">
            <div class="accordion accordion-flush" id="accordionFlushExample">
                <% for (var i=1; i<=video.length-1; i++) { %>
                <div class="accordion-item" id="lecture<%= i %>">
                    <a href="#lecture<%= i %>">
                    <h2 class="accordion-header" id="flush-heading<%= i %>">
                        <button class="accordion-button collapsed shadow-none" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapse<%= i %>" aria-expanded="false" aria-controls="flush-collapse<%= i %>"
                            onclick="streamVideo(<%=i%>)">
                            <div class="course-header w-90">
                                <div class="header-info header-title text-truncate">
                                    <%= video[i].title %>
                                </div>
                                <div class="header-info header-name header-belong">
                                    <%= video[i].name %> &nbsp; | &nbsp; <%= video[i].belong %>
                                </div>
                            </div>
                        </button>
                    </h2>
                    </a>

                    <div id="flush-collapse<%= i %>" class="accordion-collapse collapse" aria-labelledby="flush-heading<%= i %>" data-bs-parent="#accordionFlushExample">
                        <div class="accordion-body course-body">
                            <video class="video-section ratio ratio-16x9 w-90" id="video<%= i %>" controls></video>
                            <div class="horizonal-line"></div>

                            <a href="/download/<%=i%>" class="attachment-section"> 
                                <i class="bi bi-file-earmark-arrow-down-fill"></i>
                                <span> ppt download </span>
                            </a>
                            <div class="horizonal-line"></div>
                            <div class="content-section">

                            </div>
                        </div>
                    </div>
                </div>
                <% } %>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <script>
        hls_streamer = [];

        class hlsEvent {
            constructor(num) {
                this.video = document.getElementById("video" + num);
                this.videoSrc = "/hls_stream/video" + num + "/output.m3u8";

                if (Hls.isSupported()) {
                    const hls = new Hls();
        
                    hls.loadSource(this.videoSrc);
                    hls.attachMedia(this.video);
                    hls.on(Hls.Events.MANIFEST_PARSED, () => {
                        this.video.pause();
                    });
                } else if (this.video.canPlayType('application/vnd.apple.mpegurl')) {
                    this.video.src = this.videoSrc;
                    this.video.addEventListener('loadedmetadata', () => {
                        this.video.pause();
                    });
                }
            }
        }

        function streamVideo(num) {
            if (hls_streamer[num] === undefined) {
                hls_streamer[num] = new hlsEvent(num);
            }
        }
    </script>

    <div id="main-footer">
        <div class="logo-container">
            <% for (var i=1; i<=5; i++) { %>
            <img class="logo" src="img/logo<%=i%>.png">
            <% } %>
        </div>            
    </div>
</body>
</html>